<!DOCTYPE html>
<html>
  <head>
    <title>Portfolio Admin Panel</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      .preview-image {
        max-width: 150px;
        max-height: 150px;
        object-fit: contain;
      }
      .loading {
        opacity: 0.5;
        pointer-events: none;
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <h1 class="text-3xl font-bold mb-8 text-center">Portfolio Admin Panel</h1>

      <!-- Skills Section -->
      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-semibold mb-4">Skills Management</h2>

        <form id="skillForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700"
              >Skill Name</label
            >
            <input
              type="text"
              name="name"
              required
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700"
              >Category</label
            >
            <select
              name="category"
              required
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
            >
              <option value="">Select Category</option>
              <option value="Programming Languages">
                Programming Languages
              </option>
              <option value="Framework">Framework</option>
              <option value="Version Control">Version Control</option>
              <option value="Operating System">Operating System</option>

              <option value="Other">Other</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700"
              >Skill Level</label
            >
            <select
              name="level"
              required
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
            >
              <option value="">Select Level</option>
              <option value="Beginner">Beginner</option>
              <option value="Intermediate">Intermediate</option>
              <option value="Advanced">Advanced</option>
              <option value="Expert">Expert</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700">Icon</label>
            <input
              type="file"
              name="icon"
              accept="image/*"
              class="mt-1 block w-full"
            />
            <div id="skillPreview" class="mt-2"></div>
          </div>

          <button
            type="submit"
            class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"
          >
            Add Skill
          </button>
        </form>

        <div id="skillsList" class="mt-8 space-y-4"></div>
      </div>

      <!-- Projects Section -->
      <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-2xl font-semibold mb-4">Projects Management</h2>

        <form id="projectForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700"
              >Project Title</label
            >
            <input
              type="text"
              name="title"
              required
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700"
              >Description</label
            >
            <textarea
              name="description"
              required
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
            ></textarea>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700"
              >Project URL</label
            >
            <input
              type="url"
              name="project_url"
              required
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700"
              >Project Image</label
            >
            <input
              type="file"
              name="image"
              accept="image/*"
              class="mt-1 block w-full"
            />
            <div id="projectPreview" class="mt-2"></div>
          </div>

          <button
            type="submit"
            class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600"
          >
            Add Project
          </button>
        </form>

        <div id="projectsList" class="mt-8 space-y-4"></div>
      </div>
    </div>

    <script>
      // Utility functions
      function showNotification(message, isError = false) {
        const notification = document.createElement("div");
        notification.className = `fixed top-4 right-4 p-4 rounded-md ${
          isError ? "bg-red-500" : "bg-green-500"
        } text-white`;
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
      }

      function createImagePreview(file, previewElement) {
        const reader = new FileReader();
        reader.onload = function (e) {
          previewElement.innerHTML = `<img src="${e.target.result}" class="preview-image">`;
        };
        reader.readAsDataURL(file);
      }

      // Skills management
      document
        .querySelector('input[name="icon"]')
        .addEventListener("change", function (e) {
          if (this.files[0]) {
            createImagePreview(
              this.files[0],
              document.getElementById("skillPreview")
            );
          }
        });

      document
        .getElementById("skillForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const formData = new FormData(this);

          try {
            const response = await fetch("/api/skills", {
              method: "POST",
              body: formData,
            });

            if (!response.ok) throw new Error("Failed to add skill");

            showNotification("Skill added successfully");
            this.reset();
            document.getElementById("skillPreview").innerHTML = "";
            loadSkills();
          } catch (error) {
            showNotification(error.message, true);
          }
        });

      async function loadSkills() {
        try {
          const response = await fetch("/api/skills");
          const skills = await response.json();

          document.getElementById("skillsList").innerHTML = skills
            .map(
              (skill) => `
                    <div class="border p-4 rounded-md flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <img src="${skill.icon_url}" alt="${skill.name}" class="w-12 h-12 object-contain">
                            <div>
                                <h3 class="font-semibold">${skill.name}</h3>
                                <p class="text-gray-600">${skill.level}</p>
                            </div>
                        </div>
                        <button onclick="deleteSkill(${skill.id})" class="text-red-500 hover:text-red-700">Delete</button>
                    </div>
                `
            )
            .join("");
        } catch (error) {
          showNotification("Failed to load skills", true);
        }
      }

      async function deleteSkill(id) {
        if (!confirm("Are you sure you want to delete this skill?")) return;

        try {
          const response = await fetch(`/api/skills/${id}`, {
            method: "DELETE",
          });

          if (!response.ok) throw new Error("Failed to delete skill");

          showNotification("Skill deleted successfully");
          loadSkills();
        } catch (error) {
          showNotification(error.message, true);
        }
      }

      // Projects management
      document
        .querySelector('input[name="image"]')
        .addEventListener("change", function (e) {
          if (this.files[0]) {
            createImagePreview(
              this.files[0],
              document.getElementById("projectPreview")
            );
          }
        });

      document
        .getElementById("projectForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const formData = new FormData(this);

          try {
            const response = await fetch("/api/projects", {
              method: "POST",
              body: formData,
            });

            if (!response.ok) throw new Error("Failed to add project");

            showNotification("Project added successfully");
            this.reset();
            document.getElementById("projectPreview").innerHTML = "";
            loadProjects();
          } catch (error) {
            showNotification(error.message, true);
          }
        });

      async function loadProjects() {
        try {
          const response = await fetch("/api/projects");
          const projects = await response.json();

          document.getElementById("projectsList").innerHTML = projects
            .map(
              (project) => `
                    <div class="border p-4 rounded-md">
                        <div class="flex space-x-4">
                            <img src="${project.image_url}" alt="${project.title}" class="w-32 h-32 object-cover rounded">
                            <div class="flex-1">
                                <h3 class="font-semibold text-lg">${project.title}</h3>
                                <p class="text-gray-600 mt-1">${project.description}</p>
                                <a href="${project.project_url}" target="_blank" class="text-blue-500 hover:underline mt-2 inline-block">View Project</a>
                            </div>
                            <button onclick="deleteProject(${project.id})" class="text-red-500 hover:text-red-700">Delete</button>
                        </div>
                    </div>
                `
            )
            .join("");
        } catch (error) {
          showNotification("Failed to load projects", true);
        }
      }

      async function deleteProject(id) {
        if (!confirm("Are you sure you want to delete this project?")) return;

        try {
          const response = await fetch(`/api/projects/${id}`, {
            method: "DELETE",
          });

          if (!response.ok) throw new Error("Failed to delete project");

          showNotification("Project deleted successfully");
          loadProjects();
        } catch (error) {
          showNotification(error.message, true);
        }
      }

      // Initial load
      loadSkills();
      loadProjects();
    </script>
  </body>
</html>
